/*
 * Copyright (C) 2026 The ORT Server Authors (See <https://github.com/eclipse-apoapsis/ort-server/blob/main/NOTICE>)
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * SPDX-License-Identifier: Apache-2.0
 * License-Filename: LICENSE
 */

package org.eclipse.apoapsis.ortserver.shared.apimappings

import org.eclipse.apoapsis.ortserver.model.runs.repository.VulnerabilityResolution
import org.eclipse.apoapsis.ortserver.model.runs.repository.VulnerabilityResolutionReason
import org.eclipse.apoapsis.ortserver.shared.apimodel.VulnerabilityResolution as ApiVulnerabilityResolution
import org.eclipse.apoapsis.ortserver.shared.apimodel.VulnerabilityResolutionReason as ApiVulnerabilityResolutionReason

fun VulnerabilityResolution.mapToApi() = ApiVulnerabilityResolution(
    externalId = externalId,
    reason = reason.mapToApi(),
    comment = comment
)

fun VulnerabilityResolutionReason.mapToApi() = when (this) {
    VulnerabilityResolutionReason.CANT_FIX_VULNERABILITY ->
        ApiVulnerabilityResolutionReason.CANT_FIX_VULNERABILITY

    VulnerabilityResolutionReason.INEFFECTIVE_VULNERABILITY ->
        ApiVulnerabilityResolutionReason.INEFFECTIVE_VULNERABILITY

    VulnerabilityResolutionReason.INVALID_MATCH_VULNERABILITY ->
        ApiVulnerabilityResolutionReason.INVALID_MATCH_VULNERABILITY

    VulnerabilityResolutionReason.MITIGATED_VULNERABILITY ->
        ApiVulnerabilityResolutionReason.MITIGATED_VULNERABILITY

    VulnerabilityResolutionReason.NOT_A_VULNERABILITY ->
        ApiVulnerabilityResolutionReason.NOT_A_VULNERABILITY

    VulnerabilityResolutionReason.WILL_NOT_FIX_VULNERABILITY ->
        ApiVulnerabilityResolutionReason.WILL_NOT_FIX_VULNERABILITY

    VulnerabilityResolutionReason.WORKAROUND_FOR_VULNERABILITY ->
        ApiVulnerabilityResolutionReason.WORKAROUND_FOR_VULNERABILITY
}

fun ApiVulnerabilityResolutionReason.mapToModel() = when (this) {
    ApiVulnerabilityResolutionReason.CANT_FIX_VULNERABILITY ->
        VulnerabilityResolutionReason.CANT_FIX_VULNERABILITY

    ApiVulnerabilityResolutionReason.INEFFECTIVE_VULNERABILITY ->
        VulnerabilityResolutionReason.INEFFECTIVE_VULNERABILITY

    ApiVulnerabilityResolutionReason.INVALID_MATCH_VULNERABILITY ->
        VulnerabilityResolutionReason.INVALID_MATCH_VULNERABILITY

    ApiVulnerabilityResolutionReason.MITIGATED_VULNERABILITY ->
        VulnerabilityResolutionReason.MITIGATED_VULNERABILITY

    ApiVulnerabilityResolutionReason.NOT_A_VULNERABILITY ->
        VulnerabilityResolutionReason.NOT_A_VULNERABILITY

    ApiVulnerabilityResolutionReason.WILL_NOT_FIX_VULNERABILITY ->
        VulnerabilityResolutionReason.WILL_NOT_FIX_VULNERABILITY

    ApiVulnerabilityResolutionReason.WORKAROUND_FOR_VULNERABILITY ->
        VulnerabilityResolutionReason.WORKAROUND_FOR_VULNERABILITY
}
